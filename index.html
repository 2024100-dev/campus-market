<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>校园二手市场</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-bottom: 20px; }
    .product { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; }
    img { max-width: 150px; display: block; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>🎓 校园二手市场</h1>

  <form id="productForm">
    <input type="text" id="name" placeholder="商品名称" required><br>
    <textarea id="description" placeholder="商品描述" required></textarea><br>
    <input type="number" id="price" placeholder="价格" required><br>
    <input type="text" id="contact" placeholder="联系方式" required><br>
    <input type="text" id="location" placeholder="交易地点" required><br>
    <input type="file" id="image" accept="image/*"><br>
    <button type="submit">提交商品</button>
  </form>

  <h2>📋 商品列表</h2>
  <div id="productList"></div>

  <h2>✅ 测试 SVG 图标（已修复路径）</h2>
  <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2">
    <!-- ✅ 正确的 Path 写法 -->
    <path d="M12 2 L19 21 H5 Z"></path>
  </svg>

  <script>
  // ⚠️ 换成你 Apps Script 部署的 URL
  const API_URL = "https://script.google.com/macros/s/AKfycbyT5z5oldiCIB75wqDC31xoNuQ-z5k30athkggSLwORN1FuTWCT52baGgdH9sR6uXTz/exec";

  document.getElementById("productForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const file = document.getElementById("image").files[0];
    let base64Image = "";
    if (file) {
      const reader = new FileReader();
      base64Image = await new Promise((resolve) => {
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.readAsDataURL(file);
      });
    }

    const data = {
      name: document.getElementById("name").value,
      description: document.getElementById("description").value,
      price: document.getElementById("price").value,
      contact: document.getElementById("contact").value,
      location: document.getElementById("location").value,
      image: base64Image
    };

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      });

      const text = await res.text();
      const result = JSON.parse(text);

      alert(result.message || "提交完成");
      loadProducts();
    } catch (err) {
      alert("提交失败: " + err.message);
    }
  });

  async function loadProducts() {
    try {
      const res = await fetch(API_URL);
      const text = await res.text();
      const result = JSON.parse(text);

      if (result.status === "ok") {
        const list = document.getElementById("productList");
        list.innerHTML = "";
        result.items.forEach(item => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `
            <h3>${item.name}</h3>
            <p>${item.description}</p>
            <img src="${item.image}" alt="商品图片">
            <p>💰 ${item.price}</p>
            <p>📞 ${item.contact}</p>
            <p>📍 ${item.location}</p>
            <p>⏰ ${item.time}</p>
          `;
          list.appendChild(div);
        });
      }
    } catch (err) {
      console.error("加载失败", err);
    }
  }

  window.onload = loadProducts;
  </script>
</body>
</html>


