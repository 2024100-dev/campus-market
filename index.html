<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxVX1SSpuC7Lye7ybnzp15FoWmeb4VrpQD6K_mHQKcISQPo69xTJpd6xgb8ncbKRC0H/exec";

document.getElementById("productForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target;

  const product = {
    name: form.name.value,
    description: form.description.value,
    price: form.price.value,
    contact: form.contact.value,
    location: form.location.value
  };

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(product),
      headers: { "Content-Type": "application/json" }
    });
    const data = await res.json();
    alert(data.message);
    loadProducts();
  } catch (err) {
    alert("上传失败: " + err.message);
  }
});

async function loadProducts() {
  const res = await fetch(API_URL);
  const data = await res.json();
  const list = document.getElementById("productList");
  list.innerHTML = "";

  if (data.success && data.products.length > 0) {
    data.products.forEach(p => {
      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <h3>${p.name}</h3>
        <p>${p.description}</p>
        <p><b>价格:</b> ${p.price}</p>
        <p><b>联系方式:</b> ${p.contact}</p>
        <p><b>地点:</b> ${p.location}</p>
      `;
      list.appendChild(div);
    });
  } else {
    list.textContent = "目前没有商品。";
  }
}

loadProducts();
</script>

