<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>校园交易网</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      padding: 10px;
    }
    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 4px;
    }
    .card h3 {
      font-size: 18px;
      margin: 10px 0 5px;
    }
    .card p {
      margin: 4px 0;
      font-size: 14px;
      color: #555;
    }
    .contact {
      color: blue;
      font-weight: bold;
    }
    button {
      padding: 8px 16px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    input, textarea {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <h1>校园交易网</h1>
  <p style="text-align:center;">欢迎来到永平中学内部的二手交易平台！浏览商品或发布你的物品出售。</p>

  <!-- 上传按钮 -->
  <div style="text-align:center; margin: 20px;">
    <button onclick="document.getElementById('uploadForm').style.display='block'">➕ 上传商品</button>
  </div>

  <!-- 上传表单 -->
  <div id="uploadForm" style="display:none; background:#fff; padding:20px; max-width:400px; margin:0 auto; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);">
    <h3>上传商品</h3>
    <form id="productForm">
      <label>商品名称:</label>
      <input type="text" name="name" required>

      <label>描述:</label>
      <textarea name="description" required></textarea>

      <label>价格:</label>
      <input type="text" name="price" required>

      <label>联系方式:</label>
      <input type="text" name="contact" required>

      <label>交易地点:</label>
      <input type="text" name="location" value="永平中学" required>

      <label>上传图片:</label>
      <input type="file" name="image" accept="image/*" required>

      <button type="submit">提交</button>
      <button type="button" onclick="document.getElementById('uploadForm').style.display='none'">取消</button>
    </form>
    <p id="uploadStatus"></p>
  </div>

  <!-- 商品展示区 -->
  <div class="grid" id="itemsGrid"></div>

  <!-- 展示商品脚本 -->
  <script>
    const SHEET_ID = '1bADsNQM9u4WB7TjPT4t0Cj9M0ZfyuvB8K-468W0Fz64';
    const API_KEY = 'AIzaSyBTiBPjyK84dWHkleMTM2ExHMNI2--pRlM';
    const SHEET_NAME = 'Sheet1';
    const endpoint = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_NAME)}?key=${API_KEY}`;

    fetch(endpoint)
      .then(res => res.json())
      .then(data => {
        const rows = data.values;
        if (!rows || rows.length < 2) {
          document.getElementById('itemsGrid').innerHTML = '<p>暂无商品。</p>';
          return;
        }

        const items = rows.slice(1);
        const grid = document.getElementById('itemsGrid');

        items.forEach(row => {
          const [name, desc, imageUrl, price, contact, location] = row;

          const card = document.createElement('div');
          card.className = 'card';

          card.innerHTML = `
            <img src="${imageUrl}" alt="商品图片">
            <h3>${name}</h3>
            <p>${desc}</p>
            <p><strong>价格：</strong> ${price}</p>
            <p><strong>联系方式：</strong> <span class="contact">${contact}</span></p>
            <p><strong>交易地点：</strong> ${location}</p>
          `;

          grid.appendChild(card);
        });
      })
      .catch(err => {
        console.error('读取表格出错：', err);
        document.getElementById('itemsGrid').innerHTML = '<p>加载商品失败，请稍后再试。</p>';
      });
  </script>

  <!-- 上传功能脚本 -->
  <script>
    document.getElementById('productForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);

      document.getElementById('uploadStatus').innerText = '上传中...';

      fetch('https://script.google.com/macros/s/AKfycbzSiCyJn0Z1XeeILR5s8qHAA0_XPv7UtQqyWwDIpzsPWTlCiqEY14gczAh8D_b1GAM/exec', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(response => {
        document.getElementById('uploadStatus').innerText = response;
        form.reset();
        setTimeout(() => {
          document.getElementById('uploadForm').style.display = 'none';
          window.location.reload();
        }, 2000);
      })
      .catch(err => {
        console.error(err);
        document.getElementById('uploadStatus').innerText = '上传失败，请重试';
      });
    });
  </script>

</body>
</html>






