<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>校园交易网</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      padding: 10px;
    }
    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 4px;
    }
    .card h3 {
      font-size: 18px;
      margin: 10px 0 5px;
    }
    .card p {
      margin: 4px 0;
      font-size: 14px;
      color: #555;
    }
    .contact {
      color: blue;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>校园交易网</h1>
  <p style="text-align:center;">欢迎来到永平中学内部的二手交易平台！浏览商品或发布你的物品出售。</p>

  <div class="grid" id="itemsGrid"></div>

  <script>
    const SHEET_ID = '1bADsNQM9u4WB7TjPT4t0Cj9M0ZfyuvB8K-468W0Fz64';
    const API_KEY = 'AIzaSyBTiBPjyK84dWHkleMTM2ExHMNI2--pRlM';
    const SHEET_NAME = 'Sheet1';

    const endpoint = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_NAME)}?key=${API_KEY}`;

    // 提取 Google Drive 图片ID
    const extractDriveId = (url) => {
      const match = url.match(/\/d\/(.+?)\//);
      return match ? match[1] : '';
    };

    fetch(endpoint)
      .then(res => res.json())
      .then(data => {
        const rows = data.values;
        if (!rows || rows.length < 2) {
          document.getElementById('itemsGrid').innerHTML = '<p>暂无商品。</p>';
          return;
        }

        const items = rows.slice(1);
        const grid = document.getElementById('itemsGrid');

        items.forEach(row => {
          const [name, desc, imageUrl, price, contact, location] = row;

          const imageId = extractDriveId(imageUrl);
          const imageSrc = imageId ? `https://drive.google.com/uc?export=view&id=${imageId}` : '';

          const card = document.createElement('div');
          card.className = 'card';

          card.innerHTML = `
            <img src="${imageSrc}" alt="商品图片">
            <h3>${name}</h3>
            <p>${desc || ''}</p>
            <p><strong>价格：</strong> ${price}</p>
            <p><strong>联系方式：</strong> <span class="contact">${contact}</span></p>
            <p><strong>交易地点：</strong> ${location || '永平中学'}</p>
          `;

          grid.appendChild(card);
        });
      })
      .catch(err => {
        console.error('读取表格出错：', err);
        document.getElementById('itemsGrid').innerHTML = '<p>加载商品失败，请稍后再试。</p>';
      });
  </script>

</body>
</html>
  <p style="text-align:center;">欢迎来到永平中学内部的二手交易平台！浏览商品或发布你的物品出售。</p>

  <div class="grid" id="itemsGrid"></div>

  <script>
    
    const SHEET_ID = '1bADsNQM9u4WB7TjPT4t0Cj9M0ZfyuvB8K-468W0Fz64'; // 
    const API_KEY = 'AIzaSyBTiBPjyK84dWHkleMTM2ExHMNI2--pRlM';   // 

    const SHEET_NAME = 'Form Responses 1'; // 或者是中文名：表单响应1
    const endpoint = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_NAME)}?key=${API_KEY}`;

    fetch(endpoint)
      .then(res => res.json())
      .then(data => {
        const rows = data.values;
        if (!rows || rows.length < 2) {
          document.getElementById('itemsGrid').innerHTML = '<p>暂无商品。</p>';
          return;
        }

        const headers = rows[0];
        const items = rows.slice(1);
        const grid = document.getElementById('itemsGrid');

        items.forEach(row => {
          const [name, desc, imageUrl, price, contact, location] = row;

          const card = document.createElement('div');
          card.className = 'card';

          card.innerHTML = `
            <img src="${imageUrl}" alt="商品图片">
            <h3>${name}</h3>
            <p>${desc}</p>
            <p><strong>价格：</strong> ${price}</p>
            <p><strong>联系方式：</strong> <span class="contact">${contact}</span></p>
            <p><strong>交易地点：</strong> ${location}</p>
          `;

          grid.appendChild(card);
        });
      })
      .catch(err => {
        console.error('读取表格出错：', err);
        document.getElementById('itemsGrid').innerHTML = '<p>加载商品失败，请稍后再试。</p>';
      });
  </script>

</body>
</html>

