<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ ¡å›­äºŒæ‰‹å¸‚åœº</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-bottom: 20px; }
    .product { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; }
    img { max-width: 150px; display: block; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>ğŸ“ æ ¡å›­äºŒæ‰‹å¸‚åœº</h1>

  <form id="productForm">
    <input type="text" id="name" placeholder="å•†å“åç§°" required><br>
    <textarea id="description" placeholder="å•†å“æè¿°" required></textarea><br>
    <input type="number" id="price" placeholder="ä»·æ ¼" required><br>
    <input type="text" id="contact" placeholder="è”ç³»æ–¹å¼" required><br>
    <input type="text" id="location" placeholder="äº¤æ˜“åœ°ç‚¹" required><br>
    <input type="file" id="image" accept="image/*"><br>
    <button type="submit">æäº¤å•†å“</button>
  </form>

  <h2>ğŸ“‹ å•†å“åˆ—è¡¨</h2>
  <div id="productList"></div>

  <script>
  
  const API_URL = "https://script.google.com/macros/s/AKfycbzQaVXKmyf1mHr0bx7POrszENDZH4ly56N3DcIcg9cgC6bcbbj9V7WcuX_mj8Z_doRM/exec";

  document.getElementById("productForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const file = document.getElementById("image").files[0];
    let base64Image = "";
    if (file) {
      const reader = new FileReader();
      base64Image = await new Promise((resolve) => {
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.readAsDataURL(file);
      });
    }

    const data = {
      name: document.getElementById("name").value,
      description: document.getElementById("description").value,
      price: document.getElementById("price").value,
      contact: document.getElementById("contact").value,
      location: document.getElementById("location").value,
      image: base64Image
    };

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      });

      const text = await res.text();
      const result = JSON.parse(text);

      alert(result.message || "æäº¤å®Œæˆ");
      loadProducts();
    } catch (err) {
      alert("æäº¤å¤±è´¥: " + err.message);
    }
  });

  async function loadProducts() {
    try {
      const res = await fetch(API_URL);
      const text = await res.text();
      const result = JSON.parse(text);

      if (result.status === "ok") {
        const list = document.getElementById("productList");
        list.innerHTML = "";
        result.items.forEach(item => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `
            <h3>${item.name}</h3>
            <p>${item.description}</p>
            <img src="${item.image}" alt="å•†å“å›¾ç‰‡">
            <p>ğŸ’° ${item.price}</p>
            <p>ğŸ“ ${item.contact}</p>
            <p>ğŸ“ ${item.location}</p>
            <p>â° ${item.time}</p>
          `;
          list.appendChild(div);
        });
      }
    } catch (err) {
      console.error("åŠ è½½å¤±è´¥", err);
    }
  }

  window.onload = loadProducts;
  </script>
</body>
</html>
